{"version":3,"file":"monk.mjs","sources":["../../lib/compose.mjs","../../lib/applyMiddlewares.mjs","../../lib/collection.mjs","../../lib/helpers.mjs","../../node_modules/monk-middleware-query/index.js","../../node_modules/monk-middleware-options/index.js","../../node_modules/monk-middleware-cast-ids/index.js","../../node_modules/monk-middleware-fields/index.js","../../node_modules/monk-middleware-handle-callback/index.js","../../node_modules/monk-middleware-wait-for-connection/index.js","../../lib/manager.mjs","../../lib/monk.mjs"],"sourcesContent":["/**\n * Composes single-argument functions from right to left. The rightmost\n * function can take multiple arguments as it provides the signature for\n * the resulting composite function.\n *\n * @param {...Function} funcs The functions to compose.\n * @returns {Function} A function obtained by composing the argument functions\n * from right to left. For example, compose(f, g, h) is identical to doing\n * (args) => f(g(h(args))).\n */\n\nexport default function compose (funcs) {\n  if (funcs.length === 0) {\n    return function (args) { return args }\n  }\n\n  if (funcs.length === 1) {\n    return funcs[0]\n  }\n\n  return funcs.reduce(function (a, b) {\n    return function (args) {\n      return a(b(args))\n    }\n  })\n}\n","import compose from './compose.mjs'\n\n/**\n * Creates a store enhancer that applies middleware to the dispatch method\n * of the Redux store. This is handy for a variety of tasks, such as expressing\n * asynchronous actions in a concise manner, or logging every action payload.\n *\n * See `redux-thunk` package as an example of the Redux middleware.\n *\n * Because middleware is potentially asynchronous, this should be the first\n * store enhancer in the composition chain.\n *\n * Note that each middleware will be given the `dispatch` and `getState` functions\n * as named arguments.\n *\n * @param {...Function} middlewares The middleware chain to be applied.\n * @returns {Function} A store enhancer applying the middleware.\n */\nexport default function applyMiddleware (middlewares) {\n  return function (monkInstance, collection) {\n    var chain = []\n\n    var middlewareAPI = {\n      monkInstance,\n      collection\n    }\n    chain = middlewares.map(function (middleware) {\n      return middleware(middlewareAPI)\n    })\n    return compose(chain)\n  }\n}\n","import applyMiddlewares from './applyMiddlewares.mjs'\n\nexport class Collection {\n\n  constructor(manager, name, options) {\n    this.manager = manager\n    this.name = name\n    this.options = options\n\n    this.middlewares = this.options.middlewares || []\n    delete this.options.middlewares\n\n    this._dispatch = applyMiddlewares(this.middlewares)(manager, this)\n  }\n\n  bulkWrite(operations, opts, fn) {\n    if (typeof opts === 'function') {\n      fn = opts\n      opts = {}\n    }\n\n    return this._dispatch((args) => {\n      return args.col.bulkWrite(args.operations, args.options)\n    })({ options: opts, operations: operations, callback: fn }, 'bulkWrite')\n  }\n\n  ensureIndex(fields, opts, fn) {\n    throw new Error('REMOVED (collection.ensureIndex): use collection.createIndex instead (see https://Automattic.github.io/monk/docs/collection/createIndex.html)')\n  }\n\n  geoHaystackSearch(x, y, opts, fn) {\n    throw new Error('geoHaystackSearch command is not supported anymore (see https://docs.mongodb.com/manual/reference/command/geoHaystackSearch)')\n  }\n\n  geoNear() {\n    throw new Error('geoNear command is not supported anymore (see https://docs.mongodb.com/manual/reference/command/geoNear)')\n  }\n\n  group(keys, condition, initial, reduce, finalize, command, opts, fn) {\n    if (typeof opts === 'function') {\n      fn = opts\n      opts = {}\n    }\n\n    let warn = new Error('DEPRECATED (collection.group): MongoDB 3.6 or higher no longer supports the group command. We recommend rewriting using the aggregation framework.')\n    console.warn(warn)\n\n    return this._dispatch((args) => {\n      return args.col.group(args.keys, args.condition, args.initial, args.reduce, args.finalize, args.command, args.options)\n    })({ options: opts, keys: keys, condition: condition, initial: initial, reduce: reduce, finalize: finalize, command: command, callback: fn }, 'group')\n  }\n\n  mapReduce(map, reduce, opts, fn) {\n    return this._dispatch((args) => {\n      return args.col.mapReduce(args.map, args.reduce, args.options)\n    })({ map: map, reduce: reduce, options: opts, callback: fn }, 'mapReduce')\n  }\n\n  stats(opts, fn) {\n    if (typeof opts === 'function') {\n      fn = opts\n      opts = {}\n    }\n    return this._dispatch(function remove(args) {\n      return args.col.stats(args.options)\n    })({ options: opts, callback: fn }, 'stats')\n  }\n\n  aggregate(stages, opts, fn) {\n    if (typeof opts === 'function') {\n      fn = opts\n      opts = {}\n    }\n\n    return this._dispatch(function aggregate (args) {\n      return args.col.aggregate(args.stages, args.options).toArray()\n    })({options: opts, stages: stages, callback: fn}, 'aggregate')\n  }\n\n  count(query, opts, fn) {\n    if (typeof opts === 'function') {\n      fn = opts\n      opts = {}\n    }\n\n    if (typeof query === 'function') {\n      fn = query\n      query = {}\n    }\n\n    return this._dispatch(function count (args) {\n      const {estimate, ...options} = args.options\n      if (estimate) {\n        return args.col.estimatedDocumentCount(options)\n      }\n      return args.col.countDocuments(args.query, options)\n    })({options: opts, query: query, callback: fn}, 'count')\n  }\n\n  createIndex(fields, opts, fn) {\n    if (typeof opts === 'function') {\n      fn = opts\n      opts = {}\n    }\n\n    return this._dispatch(function createIndex (args) {\n      return args.col.createIndex(args.fields, args.options)\n    })({options: opts, fields: fields, callback: fn}, 'createIndex')\n  }\n\n  distinct(field, query, opts, fn) {\n    if (typeof opts === 'function') {\n      fn = opts\n      opts = {}\n    }\n\n    if (typeof query === 'function') {\n      fn = query\n      query = {}\n    }\n\n    return this._dispatch(function distinct (args) {\n      return args.col.distinct(args.field, args.query, args.options)\n    })({options: opts, query: query, field: field, callback: fn}, 'distinct')\n  }\n\n  drop(fn) {\n    return this._dispatch(function drop (args) {\n      return args.col.drop().catch(function (err) {\n        if (err && err.message === 'ns not found') {\n          return 'ns not found'\n        } else {\n          throw err\n        }\n      })\n    })({callback: fn}, 'drop')\n  }\n\n  dropIndex(fields, opts, fn) {\n    if (typeof opts === 'function') {\n      fn = opts\n      opts = {}\n    }\n\n    return this._dispatch(function dropIndex (args) {\n      return args.col.dropIndex(args.fields, args.options)\n    })({options: opts, fields: fields, callback: fn}, 'dropIndex')\n  }\n\n  dropIndexes(fn) {\n    return this._dispatch(function dropIndexes (args) {\n      return args.col.dropIndexes()\n    })({callback: fn}, 'dropIndexes')\n  }\n\n  find(query, opts, fn) {\n    if (typeof opts === 'function') {\n      fn = opts\n      opts = {}\n    }\n\n    if ((opts || {}).rawCursor) {\n      delete opts.rawCursor\n      return this._dispatch(function find (args) {\n        return Promise.resolve(args.col.find(args.query, args.options))\n      })({options: opts, query: query, callback: fn}, 'find')\n    }\n\n    var promise = this._dispatch(function find (args) {\n      var cursor = args.col.find(args.query, args.options)\n\n      if (!(opts || {}).stream && !promise.eachListener) {\n        return cursor.toArray()\n      }\n\n      if (typeof (opts || {}).stream === 'function') {\n        promise.eachListener = (opts || {}).stream\n      }\n\n      function close () {\n        cursor.close()\n      }\n      function rewind () {\n        cursor.rewind()\n      }\n      return new Promise(async function (resolve, reject) {\n        try {\n          while (await cursor.hasNext()) {\n            const doc = await cursor.next()\n            await promise.eachListener(doc, {\n              close,\n              rewind\n            })\n\n          }\n        } catch (err) {\n          if (fn) {\n            fn(err)\n          }\n          reject(err)\n        }\n        resolve()\n      })\n    })({options: opts, query: query, callback: fn}, 'find')\n\n    promise.each = function (eachListener) {\n      promise.eachListener = eachListener\n      return promise\n    }\n\n    return promise\n  }\n\n  findOne(query, opts, fn) {\n    if (typeof opts === 'function') {\n      fn = opts\n      opts = {}\n    }\n    if (typeof opts === 'string') {\n      const warn = new Error('DEPRECATED (findOne.projection): findOne should pass an options object instead of a projection string')\n      console.warn(warn)\n      opts = {projection: opts}\n    }\n    opts = opts || {}\n    if (typeof opts.projection === 'string') {\n      opts.projection = opts.projection.split(' ').reduce((acc, key) => {\n        if (key[0] === '-') {\n          acc[key.slice(1)] = 0\n        } else {\n          acc[key] = 1\n        }\n        return acc\n      }, {})\n    }\n\n    return this._dispatch(function findOne (args) {\n      return args.col.find(args.query, args.options).limit(1).toArray()\n        .then(function (docs) {\n          return (docs && docs[0]) || null\n        })\n    })({options: opts, query: query, callback: fn}, 'findOne')\n  }\n\n  findOneAndDelete(query, opts, fn) {\n    if (typeof opts === 'function') {\n      fn = opts\n      opts = {}\n    }\n    return this._dispatch(function findOneAndDelete (args) {\n      return args.col.findOneAndDelete(args.query, args.options)\n        .then(function (doc) {\n          if (doc && typeof doc.value !== 'undefined') {\n            return doc.value\n          }\n          if (doc.ok && doc.lastErrorObject && doc.lastErrorObject.n === 0) {\n            return null\n          }\n          return doc\n        })\n    })({options: opts, query: query, callback: fn}, 'findOneAndDelete')\n  }\n\n  findOneAndUpdate(query, update, opts, fn) {\n    if (typeof opts === 'function') {\n      fn = opts\n      opts = {}\n    }\n    return this._dispatch(function findOneAndUpdate (args) {\n      var method = 'findOneAndUpdate'\n      if (typeof (args.options || {}).returnDocument === 'undefined') {\n        args.options.returnDocument = \"after\"\n      }\n      if (args.options.replaceOne | args.options.replace) {\n        method = 'findOneAndReplace'\n      }\n      return args.col[method](args.query, args.update, args.options)\n        .then(function (doc) {\n          if (doc && typeof doc.value !== 'undefined') {\n            return doc.value\n          }\n          if (doc.ok && doc.lastErrorObject && doc.lastErrorObject.n === 0) {\n            return null\n          }\n          return doc\n        })\n    })({options: opts, query: query, update: update, callback: fn}, 'findOneAndUpdate')\n  }\n\n  indexes(fn) {\n    return this._dispatch(function indexes (args) {\n      return args.col.indexInformation()\n    })({callback: fn}, 'indexes')\n  }\n\n  insert(data, opts, fn) {\n    if (typeof opts === 'function') {\n      fn = opts\n      opts = {}\n    }\n\n    return this._dispatch(function insert (args) {\n      var arrayInsert = Array.isArray(args.data)\n\n      if (arrayInsert && args.data.length === 0) {\n        return Promise.resolve([])\n      }\n      const insertop = arrayInsert\n        ? args.col.insertMany(args.data, args.options)\n        : args.col.insertOne(args.data, args.options)\n      return insertop.then(function (result) {\n        if (arrayInsert) {\n          return args.data.map((doc, i) => {\n            return {\n              _id: result.insertedIds[i],\n              ...doc,\n            }\n          })\n        } else {\n          const doc = {\n            _id: result.insertedId,\n            ...args.data,\n          }\n          return doc\n        }\n      })\n    })({data: data, options: opts, callback: fn}, 'insert')\n  }\n\n  remove(query, opts, fn) {\n    if (typeof opts === 'function') {\n      fn = opts\n      opts = {}\n    }\n    return this._dispatch(function remove (args) {\n      var options = args.options || {}\n      var method = options.single || options.multi === false ? 'deleteOne' : 'deleteMany'\n      return args.col[method](args.query, args.options)\n    })({query: query, options: opts, callback: fn}, 'remove')\n  }\n\n  update(query, update, opts, fn) {\n    if (typeof opts === 'function') {\n      fn = opts\n      opts = {}\n    }\n\n    return this._dispatch(function update (args) {\n      var options = args.options || {}\n      var method = options.multi || options.single === false ? 'updateMany' : 'updateOne'\n      if (options.replace || options.replaceOne) {\n        if (options.multi || options.single === false) {\n          throw new Error('The `replace` option is only available for single updates.')\n        }\n        method = 'replaceOne'\n      }\n      return args.col[method](args.query, args.update, args.options)\n    })({update: update, query: query, options: opts, callback: fn}, 'update')\n  }\n\n  index(...args) {\n    return this.createIndex(...args)\n  }\n\n}\n\nexport default Collection\n","import mongo from 'mongodb'\n\n\n/**\n * Casts to objectid\n *\n * @param {Mixed} str - hex id or ObjectId\n * @return {ObjectId}\n * @api public\n */\n\nexport function id (str) {\n  if (str == null) return mongo.ObjectId()\n  return typeof str === 'string' ? mongo.ObjectId.createFromHexString(str) : str\n}\n\n/**\n * Applies ObjectId casting to _id fields.\n *\n * @param {Object} optional, query\n * @return {Object} query\n * @private\n */\n\nexport function cast (obj) {\n  if (Array.isArray(obj)) {\n    return obj.map(cast)\n  }\n\n  if (obj && typeof obj === 'object') {\n    Object.keys(obj).forEach(function (k) {\n      if (k === '_id' && obj._id) {\n        if (obj._id.$in) {\n          obj._id.$in = obj._id.$in.map(id)\n        } else if (obj._id.$nin) {\n          obj._id.$nin = obj._id.$nin.map(id)\n        } else if (obj._id.$ne) {\n          obj._id.$ne = id(obj._id.$ne)\n        } else {\n          obj._id = id(obj._id)\n        }\n      } else {\n        obj[k] = cast(obj[k])\n      }\n    })\n  }\n\n  return obj\n}\n\nexport default {\n  id,\n  cast\n}\n","module.exports = function queryMiddleware (context) {\n  return function (next) {\n    return function (args, method) {\n      if (!args.query) {\n        return next(args, method)\n      }\n\n      if (typeof args.query === 'string' || typeof args.query.toHexString === 'function') {\n        args.query = {_id: args.query}\n      }\n\n      return next(args, method)\n    }\n  }\n}\n","function fields (obj, numberWhenMinus) {\n  if (!Array.isArray(obj) && typeof obj === 'object') {\n    return obj\n  }\n\n  var fields = {}\n  obj = typeof obj === 'string' ? obj.split(' ') : (obj || [])\n\n  for (var i = 0, l = obj.length; i < l; i++) {\n    if (obj[i][0] === '-') {\n      fields[obj[i].substr(1)] = numberWhenMinus\n    } else {\n      fields[obj[i]] = 1\n    }\n  }\n\n  return fields\n}\n\nmodule.exports = function optionsMiddleware (context) {\n  return function (next) {\n    return function (args, method) {\n      var collection = context.collection\n      if (typeof args.options === 'string' || Array.isArray(args.options)) {\n        args.options = { fields: fields(args.options) }\n        return next(args, method)\n      }\n      args.options = args.options || {}\n      if (args.options.fields) {\n        args.options.fields = fields(args.options.fields, 0)\n      }\n      if (args.options.sort) {\n        args.options.sort = fields(args.options.sort, -1)\n      }\n\n      for (var j in collection.options) {\n        if (!(j in args.options)) {\n          args.options[j] = collection.options[j]\n        }\n      }\n      return next(args, method)\n    }\n  }\n}\n","module.exports = function castIdsMiddleware (fieldsToCast) {\n  return function (context) {\n    return function (next) {\n      return function (args, method) {\n        if ((args.options || {}).castIds === false) {\n          delete args.options.castIds\n          return next(args, method)\n        }\n\n        if ((args.options || {}).castIds) {\n          delete args.options.castIds\n        }\n\n        fieldsToCast.forEach(function (k) {\n          if (args[k]) {\n            args[k] = context.monkInstance.cast(args[k])\n          }\n        })\n\n        return next(args, method)\n      }\n    }\n  }\n}\n","module.exports = function fieldsMiddleware (context) {\n  return function (next) {\n    return function (args, method) {\n      if (!args.fields) {\n        return next(args, method)\n      }\n\n      if (!Array.isArray(args.fields) && typeof args.fields === 'object') {\n        return next(args, method)\n      }\n\n      var fields = {}\n      args.fields = typeof args.fields === 'string' ? args.fields.split(' ') : (args.fields || [])\n\n      for (var i = 0, l = args.fields.length; i < l; i++) {\n        fields[args.fields[i]] = 1\n      }\n\n      args.fields = fields\n      return next(args, method)\n    }\n  }\n}\n","function thenFn (fn) {\n  return function (res) {\n    if (fn && typeof fn === 'function') {\n      setTimeout(fn, 0, null, res)\n    }\n    return res\n  }\n}\n\nfunction catchFn (fn) {\n  return function (err) {\n    if (fn && typeof fn === 'function') {\n      setTimeout(fn, 0, err)\n      return\n    }\n    throw err\n  }\n}\n\nmodule.exports = function handleCallback (context) {\n  return function (next) {\n    return function (args, method) {\n      return next(args, method).then(thenFn(args.callback)).catch(catchFn(args.callback))\n    }\n  }\n}\n","module.exports = function waitForConnection (context) {\n  return function (next) {\n    return function (args, method) {\n      return context.monkInstance.executeWhenOpened().then(function (db) {\n        return db.collection(context.collection.name)\n      }).then(function (col) {\n        args.col = col\n        return next(args, method)\n      })\n    }\n  }\n}\n","/**\n * The version of MonDb used by Monk requires the whatwg-url module. Whatwg-url\n * inturn requires the TextEncoder and TextDecoder modules. These modules are\n * not available in Node.js by default. The following code snippet is a\n * workaround to provide these modules in Node.js.\n */\nimport { TextEncoder, TextDecoder } from 'util'\nglobal.TextEncoder = TextEncoder\nglobal.TextDecoder = TextDecoder\n\nimport mongo from \"mongodb\"\nimport Debug from \"debug\"\nimport objectAssign from \"object-assign\"\nimport Collection from \"./collection.mjs\"\nimport { EventEmitter } from \"events\"\nimport helpers from \"./helpers.mjs\"\nimport monkMiddlewareQuery from \"monk-middleware-query\"\nimport monkMiddlewareOptions from \"monk-middleware-options\"\nimport monkMiddlewareCastIds from \"monk-middleware-cast-ids\"\nimport monkMiddlewareFields from \"monk-middleware-fields\"\nimport monkMiddlewareHandleCallback from \"monk-middleware-handle-callback\"\nimport monkMiddlewareWaitForConnection from \"monk-middleware-wait-for-connection\"\n\nvar monkDebug = Debug(\"monk:manager\")\nvar MongoClient = mongo.MongoClient\n\nvar STATE = {\n  CLOSED: \"closed\",\n  OPENING: \"opening\",\n  OPEN: \"open\",\n}\n\nvar FIELDS_TO_CAST = [\"operations\", \"query\", \"data\", \"update\"]\n\nvar DEFAULT_OPTIONS = {\n  castIds: true,\n  middlewares: [\n    monkMiddlewareQuery,\n    monkMiddlewareOptions,\n    monkMiddlewareCastIds(FIELDS_TO_CAST),\n    monkMiddlewareFields,\n    monkMiddlewareHandleCallback,\n    monkMiddlewareWaitForConnection,\n  ],\n}\n\n/**\n * Monk constructor.\n *\n * @param {Array|String} uri replica sets can be an array or\n * comma-separated\n * @param {Object|Function} opts or connect callback\n * @return {Promise} resolve when the connection is opened\n */\n\nexport class Manager extends EventEmitter {\n  constructor(uri, opts, fn) {\n    super()\n    if (!uri) {\n      throw Error(\"No connection URI provided.\")\n    }\n\n    if (typeof opts === \"function\") {\n      fn = opts\n      opts = {}\n    }\n\n    opts = opts || {}\n\n    if (!opts.hasOwnProperty(\"useNewUrlParser\")) {\n      opts.useNewUrlParser = true\n    }\n    if (!opts.hasOwnProperty(\"useUnifiedTopology\")) {\n      opts.useUnifiedTopology = true\n    }\n\n    this._collectionOptions = objectAssign(\n      {},\n      DEFAULT_OPTIONS,\n      opts.collectionOptions || {}\n    )\n    this._collectionOptions.middlewares =\n      this._collectionOptions.middlewares.slice(0)\n    delete opts.collectionOptions\n\n    if (Array.isArray(uri)) {\n      if (!opts.database) {\n        for (var i = 0, l = uri.length; i < l; i++) {\n          if (!opts.database) {\n            opts.database = uri[i].replace(/([^/])+\\/?/, \"\")\n          }\n          uri[i] = uri[i].replace(/\\/.*/, \"\")\n        }\n      }\n      uri = uri.join(\",\") + \"/\" + opts.database\n      monkDebug(\n        'repl set connection \"%j\" to database \"%s\"',\n        uri,\n        opts.database\n      )\n    }\n\n    if (typeof uri === \"string\") {\n      if (!/^mongodb(\\+srv)?:\\/\\//.test(uri)) {\n        uri = \"mongodb://\" + uri\n      }\n    }\n\n    this._state = STATE.OPENING\n    this.emit(\"opening\")\n\n    this._queue = []\n    this.on(\"open\",\n      (db) => {\n        monkDebug(\"connection opened\")\n        monkDebug(\"emptying queries queue (%s to go)\", this._queue.length)\n        this._queue.forEach(function (cb) {\n          cb(db)\n        })\n        this._queue = []\n      }\n    )\n\n    this._connectionURI = uri\n    this._connectionOptions = opts\n\n    this.open(\n      uri,\n      opts,\n      fn &&\n        function (err) {\n          fn(err, this)\n        }.bind(this)\n    )\n\n    this.helper = {\n      id: mongo.ObjectId,\n    }\n\n    this.collections = {}\n  }\n  /**\n   * Then\n   *\n   * @param {Function} [fn] - callback\n   */\n  then(fn) {\n    const err = new Error(\n      \"DEPRECATED (manager.then) then is deprecated, please use the promise interface\"\n    )\n    return new Promise(\n      function (resolve, reject) {\n        this.once(\"open\", resolve)\n        this.once(\"error-opening\", reject)\n      }.bind(this)\n    ).then(fn.bind(null, this))\n  }\n  /**\n   * Catch\n   *\n   * @param {Function} [fn] - callback\n   */\n  catch(fn) {\n    const err = new Error(\n      \"DEPRECATED (manager.catch) catch is deprecated, please use the promise interface\"\n    )\n    return new Promise(\n      function (resolve) {\n        this.once(\"error-opening\", resolve)\n      }.bind(this)\n    ).then(fn.bind(null))\n  }\n  /**\n   * Lists all collections.\n   *\n   * @param {Object} [query] - A query expression to filter the list of collections.\n   * @return {Array} array of all collections\n   */\n  async listCollections(query) {\n    const db = await this.executeWhenOpened()\n    const cols = await db.listCollections(query).toArray()\n    return cols.map((x) => this.get(x).name)\n  }\n  /**\n   * Create a collection.\n   *\n   * @param {String} name - name of the mongo collection\n   * @param {Object} [creationOptions] - options used when creating the collection\n   * @param {Object} [options] - options to pass to the collection\n   * @return {Collection} collection to query against\n   */\n  create(name, creationOptions, options) {\n    this.executeWhenOpened()\n      .then(function (db) {\n        db.createCollection(name, creationOptions)\n      })\n      .catch(function (err) {\n        this.emit(\"error\", err)\n      })\n\n    return this.get(name, options)\n  }\n\n  /**\n   * Open the connection\n   * @private\n   */\n  async open(uri, opts, fn) {\n    let err\n    try {\n      const client = await MongoClient.connect(uri, opts)\n      this._state = STATE.OPEN\n\n      this._client = client\n      this._db = client.db()\n\n      // set up events\n      // ;['authenticated', 'close', 'error', 'fullsetup', 'parseError', 'reconnect', 'timeout'].forEach((eventName) => {\n      //   this._db.on(eventName, (e) => {\n      //     this.emit(eventName, e)\n      //   })\n      // })\n      this.on(\"reconnect\", () => {\n        this._state = STATE.OPEN\n      })\n\n      this.emit(\"open\", this._db)\n      this.emit(\"reconnect\", this._db)\n    } catch (error) {\n      this._state = STATE.CLOSED\n      this.emit(\"error-opening\", error)\n      this.emit(\"error\", error)\n      err = error\n    }\n    if (fn) {\n      const warn = new Error(\n        \"DEPRECATED (manager.open) call back function is deprecated, please use the promise interface\"\n      )\n      console.warn(warn)\n      fn(err, this)\n    }\n  }\n\n  /**\n   * Execute when connection opened.\n   * @private\n   */\n\n  executeWhenOpened() {\n    return new Promise((resolve) => {\n      switch (this._state) {\n        case STATE.OPEN:\n          return resolve(this._db)\n        case STATE.OPENING:\n          this._queue.push(resolve)\n          break\n        case STATE.CLOSED:\n        default:\n          this._queue.push(resolve)\n          this.open(this._connectionURI, this._connectionOptions)\n      }\n    })\n  }\n\n  /**\n   * Closes the connection.\n   *\n   * @param {Boolean} [force] - Force close, emitting no events\n   * @return {Promise}\n   */\n\n  close(force, fn) {\n    if (typeof force === \"function\") {\n      fn = force\n      force = false\n    }\n    if (typeof fn === \"function\") {\n      const warn = new Error(\n        \"DEPRECATED (manager.close) call back function is deprecated, please use the promise interface\"\n      )\n      console.warn(warn)\n    }\n\n    const closeClient = (resolve) => {\n      this._client.close(force, () => {\n        this._state = STATE.CLOSED\n        if (fn) {\n          fn()\n        }\n        this.emit(\"close\")\n        resolve()\n      })\n    }\n\n    return new Promise((resolve) => {\n      switch (this._state) {\n        case STATE.CLOSED:\n          if (fn) {\n            fn()\n          }\n          return resolve()\n        case STATE.OPENING:\n          this._queue.push(function () {\n            closeClient(resolve)\n          })\n          break\n        case STATE.OPEN:\n        default:\n          closeClient(resolve)\n      }\n    })\n  }\n\n  /**\n   * Gets a collection.\n   *\n   * @param {String} name - name of the mongo collection\n   * @param {Object} [options] - options to pass to the collection\n   * @return {Collection} collection to query against\n   */\n\n  get(name, options) {\n    if ((options || {}).cache === false || !this.collections[name]) {\n      delete (options || {}).cache\n      this.collections[name] = new Collection(\n        this,\n        name,\n        objectAssign({}, this._collectionOptions || {}, options || {})\n      )\n    }\n\n    return this.collections[name]\n  }\n\n  setDefaultCollectionOptions(options) {\n    this._collectionOptions = options\n  }\n\n  addMiddleware(middleware) {\n    if (!this._collectionOptions) {\n      this._collectionOptions = {}\n    }\n    if (!this._collectionOptions.middlewares) {\n      this._collectionOptions.middlewares = []\n    }\n    this._collectionOptions.middlewares.push(middleware)\n  }\n\n  /**\n   * Add some helpers\n   */\n  col(...args) {\n    return this.get(...args)\n  }\n\n  static oid(...args) {\n    return helpers.id(...args)\n  }\n  oid(...args) {\n    return helpers.id(...args)\n  }\n\n  static id(...args) {\n    return helpers.id(...args)\n  }\n  id(...args) {\n    return helpers.id(...args)\n  }\n\n  static cast(...args) {\n    return helpers.cast(...args)\n  }\n  cast(...args) {\n    return helpers.cast(...args)\n  }\n\n}\n\n/*\n * support for calling monk() directly\n */\n\nconst monk = function (...args) {\n  return new Manager(...args)\n}\n\nmonk.id = helpers.id\nmonk.cast = helpers.cast\n\nexport default monk\n","import manager from './manager.mjs'\nimport helpers from './helpers.mjs'\nimport { Collection } from './collection.mjs'\nexport default manager\nexport { manager, Collection }\nexport { helpers }\nexport const id = helpers.id\n"],"names":["compose","funcs","length","args","reduce","a","b","applyMiddleware","middlewares","monkInstance","collection","chain","middlewareAPI","map","middleware","Collection","constructor","manager","name","options","_dispatch","applyMiddlewares","bulkWrite","operations","opts","fn","col","callback","ensureIndex","fields","Error","geoHaystackSearch","x","y","geoNear","group","keys","condition","initial","finalize","command","warn","console","mapReduce","stats","remove","aggregate","stages","toArray","count","query","estimate","estimatedDocumentCount","countDocuments","createIndex","distinct","field","drop","catch","err","message","dropIndex","dropIndexes","find","rawCursor","Promise","resolve","promise","cursor","stream","eachListener","close","rewind","reject","hasNext","doc","next","each","findOne","projection","split","acc","key","slice","limit","then","docs","findOneAndDelete","value","ok","lastErrorObject","n","findOneAndUpdate","update","method","returnDocument","replaceOne","replace","indexes","indexInformation","insert","data","arrayInsert","Array","isArray","insertop","insertMany","insertOne","result","i","_id","insertedIds","insertedId","single","multi","index","id","str","mongo","ObjectId","createFromHexString","cast","obj","Object","forEach","k","$in","$nin","$ne","global","TextEncoder","TextDecoder","monkDebug","Debug","MongoClient","STATE","CLOSED","OPENING","OPEN","FIELDS_TO_CAST","DEFAULT_OPTIONS","castIds","monkMiddlewareQuery","monkMiddlewareOptions","monkMiddlewareCastIds","monkMiddlewareFields","monkMiddlewareHandleCallback","monkMiddlewareWaitForConnection","Manager","EventEmitter","uri","hasOwnProperty","useNewUrlParser","useUnifiedTopology","_collectionOptions","objectAssign","collectionOptions","database","l","join","test","_state","emit","_queue","on","db","cb","_connectionURI","_connectionOptions","open","bind","helper","collections","once","listCollections","executeWhenOpened","cols","get","create","creationOptions","createCollection","client","connect","_client","_db","error","push","force","closeClient","cache","setDefaultCollectionOptions","addMiddleware","oid","helpers","monk"],"mappings":"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"}